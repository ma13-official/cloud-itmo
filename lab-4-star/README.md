# Работа с секретами через HashiCorp Vault

В этой работе мы рассмотрели процесс работы с секретами через HashiCorp Vault, который является безопасным и удобным инструментом для хранения и управления конфиденциальной информацией, такой как пароли, API-ключи, сертификаты и другое

## Поднятие HashiCorp Vault

Для начала нам нужно поднять HashiCorp Vault с помощью Docker. Мы использовали команду:

```bash
docker-compose up -d
```

![image](https://github.com/user-attachments/assets/e30fb982-60e8-4ef1-a9e7-8d3cddbdfddf)

## Вход в Vault

После того как контейнер с Vault поднят, нужно войти в систему с использованием токена root. Это можно сделать с помощью команды:

```bash
vault login root
```

Но здесь возникла первая  **трудность**. Появилась следующая ошибка:

Error authenticating: error looking up token: Get "https://127.0.0.1:8200/v1/auth/token/lookup-self": http: server gave HTTP response to HTTPS client

Это связано с тем, что клиент Vault ожидает соединения через HTTPS, а я использовал HTTP, нужно указать явно, что Vault должен использовать HTTP:

```bash
vault login -address=http://127.0.0.1:8200 root
```
![image](https://github.com/user-attachments/assets/b1dc2e7f-d2d3-4ecb-aad2-df921b0aff80)

 **Success!**

![image](https://github.com/user-attachments/assets/7b08b05a-d71f-4eb0-9d17-dc71da7af125)

## Добавление секретов в Vault

После входа в систему мы создали секреты, которые будут храниться в Vault. Для этого использовали команду:

```bash
vault kv put secret/myapp DB_USER=myuser DB_PASSWORD=mypassword
```

Эти секреты включают в себя имя пользователя и пароль для приложения, которые теперь можно безопасно хранить в Vault, с помощью команды vault kv get можно получить значения секретов:

```bash
vault kv get -address=http://127.0.0.1:8200 secret/myapp
```

Для создания токена с нужными правами доступа использовали команду:

```bash
vault token create -address=http://127.0.0.1:8200 -policy=root
```

![image](https://github.com/user-attachments/assets/26b28d5d-8b61-4ffc-9d95-a2158711df02)

Этот токен может быть использован для авторизации и доступа к секретам

В браузере можно перейти по адресу http://localhost:8200/ui/vault/secrets/secret/kv/myapp/ и просмотреть секреты

![image](https://github.com/user-attachments/assets/040f6afd-d56e-4e2a-a0f0-87582d4d7363)

## Интеграция с CI/CD

Были настроены переменные окружения в GitHub Secrets для работы с Vault:

* VAULT_ADDR: http://127.0.0.1:8200
* VAULT_TOKEN: hvs**********************PUx (токен, который был получен ранее)

Эти секреты были добавлены в раздел Settings → Secrets and variables → Actions

Теперь CI/CD пайплайн может безопасно извлекать секреты из Vault и использовать их в процессе сборки и деплоя, не раскрывая их в логах

![image](https://github.com/user-attachments/assets/c4552038-be3c-47e6-a888-171d6f69cb25)

Хранение секретов в CI/CD переменных репозитория, например, через GitHub Actions или другие платформы, не является лучшей практикой по нескольким причинам:

Безопасность: хотя GitHub и другие платформы предлагают возможность безопасного хранения переменных, эти секреты все равно могут быть раскрыты в случае неправильной настройки или утечек

Отсутствие централизованного контроля: в большинстве случаев секреты хранятся в различных местах (например, в переменных окружения для каждого репозитория). Это затрудняет управление доступом и мониторинг, особенно когда работаешь с несколькими репозиториями

Сложность масштабирования: при масштабировании системы, если каждый репозиторий будет хранить свои секреты в отдельных CI/CD переменных, это приведет к значительным сложностям в управлении доступом и хранении этих данных

## Вывод
В ходе выполнения данной практической работы был поднят Hashicorp Vault. Его использование для хранения секретов обеспечивает высокий уровень безопасности, а также удобство управления секретами в различных сервисах и приложениях. В отличие от хранения секретов в CI/CD переменных репозитория, Vault предоставляет централизованный и безопасный способ работы с конфиденциальной информацией, минимизируя риски утечек и неправильного использования данных.

Хорошего дня, удачного вечера, балдёжного времяпрепровождения, всем удачи, счастья, балдежа, всем пока, всего наилучшего. Спасибо за поддержку, спасибо за понимание, спасибо за хорошие комментарии, спасибо за плохие комментарии, спасибо за лайки, спасибо за дизлайки. Я всем рад и всем доволен
